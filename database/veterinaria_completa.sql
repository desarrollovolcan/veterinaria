-- Base de datos completa Veterinaria MVC
-- Generado automáticamente desde app/Core/Database.php
CREATE DATABASE IF NOT EXISTS veterinaria CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE veterinaria;

CREATE TABLE IF NOT EXISTS system_roles (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(120) NOT NULL, descripcion TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS system_users (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(120) NOT NULL, email VARCHAR(180), password VARCHAR(255), rol VARCHAR(80), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS user_permissions (id INT AUTO_INCREMENT PRIMARY KEY, user_id INT NOT NULL, module_key VARCHAR(120) NOT NULL, can_view TINYINT(1) DEFAULT 1, can_edit TINYINT(1) DEFAULT 0, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS clinic_profile (id INT AUTO_INCREMENT PRIMARY KEY, nombre_clinica VARCHAR(180), razon_social VARCHAR(180), telefono VARCHAR(40), email VARCHAR(180), direccion TEXT, logo_path VARCHAR(255), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS audit_logs (id INT AUTO_INCREMENT PRIMARY KEY, entidad VARCHAR(120), entidad_id INT, accion VARCHAR(60), usuario_id INT NULL, payload_json LONGTEXT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS owners (id INT AUTO_INCREMENT PRIMARY KEY, rut VARCHAR(20), nombre_completo VARCHAR(180), telefono VARCHAR(40), email VARCHAR(180), direccion TEXT, observacion TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL, deleted_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS pets (id INT AUTO_INCREMENT PRIMARY KEY, owner_id INT, nombre VARCHAR(120), especie VARCHAR(80), raza VARCHAR(120), sexo VARCHAR(20), fecha_nacimiento DATE NULL, microchip VARCHAR(80), esterilizado VARCHAR(20), color VARCHAR(80), peso VARCHAR(40), notas TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS vets (id INT AUTO_INCREMENT PRIMARY KEY, usuario_id INT, nombre VARCHAR(120), especialidad VARCHAR(120), firma VARCHAR(255), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS appointments (id INT AUTO_INCREMENT PRIMARY KEY, inicio DATETIME NULL, fin DATETIME NULL, vet_id INT, pet_id INT, motivo VARCHAR(255), estado VARCHAR(50), notas TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS clinical_visits (id INT AUTO_INCREMENT PRIMARY KEY, fecha DATE NULL, appointment_id INT, vet_id INT, pet_id INT, peso VARCHAR(40), temperatura VARCHAR(40), motivo VARCHAR(255), examen_fisico TEXT, diagnostico TEXT, plan_tratamiento TEXT, receta_json LONGTEXT, notas TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS ai_assistant_suggestions (id INT AUTO_INCREMENT PRIMARY KEY, tipo VARCHAR(120), pet_nombre VARCHAR(180), owner_nombre VARCHAR(180), titulo VARCHAR(255), prioridad VARCHAR(40), resumen TEXT, accion_sugerida TEXT, confianza DECIMAL(5,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS vaccinations (id INT AUTO_INCREMENT PRIMARY KEY, pet_id INT, tipo_vacuna VARCHAR(160), fecha_aplicada DATE NULL, proxima_fecha DATE NULL, lote VARCHAR(120), observacion TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS dewormings (id INT AUTO_INCREMENT PRIMARY KEY, pet_id INT, tipo VARCHAR(120), producto VARCHAR(180), fecha DATE NULL, proxima_fecha DATE NULL, observacion TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS products (id INT AUTO_INCREMENT PRIMARY KEY, sku VARCHAR(120), nombre VARCHAR(180), tipo VARCHAR(120), unidad VARCHAR(40), precio_compra DECIMAL(12,2) NULL, precio_venta DECIMAL(12,2) NULL, stock_minimo DECIMAL(12,2) NULL, stock_actual DECIMAL(12,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS invoices (id INT AUTO_INCREMENT PRIMARY KEY, folio VARCHAR(80), owner_id INT, pet_id INT, fecha DATETIME NULL, items_json LONGTEXT, descuento DECIMAL(12,2) NULL, total DECIMAL(12,2) NULL, metodo_pago VARCHAR(60), estado_pago VARCHAR(60), updated_at TIMESTAMP NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS hospitalizations (id INT AUTO_INCREMENT PRIMARY KEY, pet_id INT, vet_id INT, fecha_ingreso DATETIME NULL, motivo VARCHAR(255), estado VARCHAR(60), observacion TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS surgeries (id INT AUTO_INCREMENT PRIMARY KEY, pet_id INT, vet_id INT, fecha_programada DATETIME NULL, estado VARCHAR(60), consentimiento TEXT, protocolo TEXT, notas TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS laboratory_orders (id INT AUTO_INCREMENT PRIMARY KEY, pet_id INT, vet_id INT, fecha DATE NULL, tipo_examen VARCHAR(180), estado VARCHAR(60), observacion TEXT, resultado_archivo VARCHAR(255), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS audit_trail (id INT AUTO_INCREMENT PRIMARY KEY, usuario VARCHAR(160), modulo VARCHAR(120), accion VARCHAR(120), detalle TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS report_requests (id INT AUTO_INCREMENT PRIMARY KEY, tipo VARCHAR(120), rango_desde DATE NULL, rango_hasta DATE NULL, formato VARCHAR(60), notas TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS access_requests (id INT AUTO_INCREMENT PRIMARY KEY, usuario VARCHAR(160), rol VARCHAR(120), permiso VARCHAR(120), estado VARCHAR(20) DEFAULT 'ACTIVO', observacion TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS settings (id INT AUTO_INCREMENT PRIMARY KEY, clave VARCHAR(160), valor TEXT, categoria VARCHAR(120), detalle TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS master_catalogs (id INT AUTO_INCREMENT PRIMARY KEY, tipo VARCHAR(120), nombre VARCHAR(160), descripcion TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS service_rates (id INT AUTO_INCREMENT PRIMARY KEY, codigo VARCHAR(80), servicio VARCHAR(180), precio DECIMAL(12,2) NULL, descuento DECIMAL(12,2) NULL, convenio VARCHAR(180), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS suppliers_purchases (id INT AUTO_INCREMENT PRIMARY KEY, proveedor VARCHAR(180), nro_documento VARCHAR(120), fecha DATE NULL, total DECIMAL(12,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', observacion TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS receivables (id INT AUTO_INCREMENT PRIMARY KEY, cliente VARCHAR(180), documento VARCHAR(120), monto DECIMAL(12,2) NULL, vencimiento DATE NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', recordatorio TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS documents_consents (id INT AUTO_INCREMENT PRIMARY KEY, tipo VARCHAR(120), titulo VARCHAR(180), archivo VARCHAR(255), detalle TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS communications (id INT AUTO_INCREMENT PRIMARY KEY, canal VARCHAR(60), destino VARCHAR(180), asunto VARCHAR(180), mensaje TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS client_portal (id INT AUTO_INCREMENT PRIMARY KEY, cliente VARCHAR(180), email VARCHAR(180), tipo VARCHAR(120), detalle TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS whatsapp_email_reminders (id INT AUTO_INCREMENT PRIMARY KEY, tipo VARCHAR(60), destino VARCHAR(180), fecha_programada DATETIME NULL, mensaje TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS marketing_campaigns (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), canal VARCHAR(60), audiencia VARCHAR(180), contenido TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS electronic_prescriptions (id INT AUTO_INCREMENT PRIMARY KEY, clinical_visit_id INT, folio VARCHAR(80), medicamentos LONGTEXT, indicaciones TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS dte_management (id INT AUTO_INCREMENT PRIMARY KEY, tipo_dte VARCHAR(80), folio VARCHAR(80), receptor VARCHAR(180), monto DECIMAL(12,2) NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS manager_profile (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), email VARCHAR(180), telefono VARCHAR(40), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS doctor_profile (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), especialidad VARCHAR(180), registro VARCHAR(120), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS technician_profile (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), area VARCHAR(180), turno VARCHAR(80), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS reception_profile (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), email VARCHAR(180), telefono VARCHAR(40), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS cage_management (id INT AUTO_INCREMENT PRIMARY KEY, codigo_jaula VARCHAR(80), ubicacion VARCHAR(180), capacidad INT NULL, estado VARCHAR(40) DEFAULT 'Disponible', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS hospitalized_treatments (id INT AUTO_INCREMENT PRIMARY KEY, hospitalization_id INT, tratamiento VARCHAR(180), dosis VARCHAR(120), frecuencia VARCHAR(120), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS hospital_discharge (id INT AUTO_INCREMENT PRIMARY KEY, hospitalization_id INT, fecha_alta DATE NULL, indicaciones TEXT, estado VARCHAR(40) DEFAULT 'Emitida', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS pharmacy_sales (id INT AUTO_INCREMENT PRIMARY KEY, folio VARCHAR(80), cliente VARCHAR(180), total DECIMAL(12,2) NULL, medio_pago VARCHAR(80), estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS ambulatory_charges (id INT AUTO_INCREMENT PRIMARY KEY, boleta VARCHAR(80), cliente VARCHAR(180), monto DECIMAL(12,2) NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS hospital_charges (id INT AUTO_INCREMENT PRIMARY KEY, boleta VARCHAR(80), cliente VARCHAR(180), monto DECIMAL(12,2) NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS cash_management (id INT AUTO_INCREMENT PRIMARY KEY, caja VARCHAR(80), responsable VARCHAR(180), saldo_apertura DECIMAL(12,2) NULL, saldo_cierre DECIMAL(12,2) NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS current_accounts (id INT AUTO_INCREMENT PRIMARY KEY, cliente VARCHAR(180), detalle TEXT, saldo DECIMAL(12,2) NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS payments_installments (id INT AUTO_INCREMENT PRIMARY KEY, cliente VARCHAR(180), referencia VARCHAR(180), monto DECIMAL(12,2) NULL, fecha DATE NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS inventory_count (id INT AUTO_INCREMENT PRIMARY KEY, producto VARCHAR(180), stock_sistema DECIMAL(12,2) NULL, stock_fisico DECIMAL(12,2) NULL, responsable VARCHAR(180), estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS internal_receipts (id INT AUTO_INCREMENT PRIMARY KEY, folio VARCHAR(80), cliente VARCHAR(180), detalle TEXT, total DECIMAL(12,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS dte_book (id INT AUTO_INCREMENT PRIMARY KEY, periodo VARCHAR(80), resumen TEXT, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS attendance_module (id INT AUTO_INCREMENT PRIMARY KEY, colaborador VARCHAR(180), fecha DATE NULL, turno VARCHAR(80), asistencia VARCHAR(40), estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS owner_pet_relationship (id INT AUTO_INCREMENT PRIMARY KEY, owner_id INT, pet_id INT, observacion TEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS preset_documents (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), tipo VARCHAR(120), contenido LONGTEXT, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS payment_methods (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(120), codigo VARCHAR(60), comision DECIMAL(12,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS benefits_management (id INT AUTO_INCREMENT PRIMARY KEY, codigo VARCHAR(80), prestacion VARCHAR(180), precio DECIMAL(12,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS exams_management (id INT AUTO_INCREMENT PRIMARY KEY, nombre_examen VARCHAR(180), tipo VARCHAR(120), precio DECIMAL(12,2) NULL, estado VARCHAR(20) DEFAULT 'ACTIVO', created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS pacs_connections (id INT AUTO_INCREMENT PRIMARY KEY, nombre VARCHAR(180), modalidad VARCHAR(20), endpoint VARCHAR(255), estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS medical_payments (id INT AUTO_INCREMENT PRIMARY KEY, medico VARCHAR(180), periodo VARCHAR(80), monto DECIMAL(12,2) NULL, estado VARCHAR(40), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP NULL);

INSERT INTO system_roles (nombre, descripcion, estado) SELECT 'SuperRoot', 'Acceso total del sistema', 'ACTIVO' WHERE NOT EXISTS (SELECT 1 FROM system_roles);
INSERT INTO system_users (nombre, email, password, rol, estado) SELECT 'SuperRoot Demo', 'superroot@veterinaria.local', '', 'SuperRoot', 'ACTIVO' WHERE NOT EXISTS (SELECT 1 FROM system_users WHERE email = 'superroot@veterinaria.local');
INSERT INTO system_users (nombre, email, password, rol, estado) SELECT 'Administrador General', 'admin@veterinaria.local', '\$2y\$12\$GSYpm4btlT7c6OMSz15FYuTk5Lb/ZM1acdBE0rh4mDw6Hd16i8fcS', 'SuperRoot', 'ACTIVO' WHERE NOT EXISTS (SELECT 1 FROM system_users WHERE email = 'admin@veterinaria.local');
INSERT INTO user_permissions (user_id, module_key, can_view, can_edit, estado) SELECT su.id, '*', 1, 1, 'ACTIVO' FROM system_users su WHERE su.rol = 'SuperRoot' AND NOT EXISTS (SELECT 1 FROM user_permissions up WHERE up.user_id = su.id AND up.module_key = '*');
INSERT INTO clinic_profile (nombre_clinica, razon_social, telefono, email, direccion, estado) SELECT 'Clínica Veterinaria', 'Clínica Veterinaria', '+56 9 0000 0000', 'contacto@veterinaria.local', 'Dirección principal', 'ACTIVO' WHERE NOT EXISTS (SELECT 1 FROM clinic_profile);
